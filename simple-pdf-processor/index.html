<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Processor</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .upload-zone {
            border: 2px dashed #2196F3;
            padding: 40px;
            text-align: center;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            margin: 20px 0;
        }

        .upload-zone:hover {
            background: #f0f8ff;
        }

        .results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .log {
            background: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .status {
            padding: 8px 16px;
            border-radius: 16px;
            display: inline-block;
            font-size: 14px;
        }

        .status.ready { background: #4CAF50; color: white; }
        .status.processing { background: #FFC107; color: black; }
        .status.error { background: #f44336; color: white; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .card h3 {
            margin-top: 0;
            color: #2196F3;
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            background: #e3f2fd;
            border-radius: 4px;
            font-size: 12px;
        }

        .preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>PDF Processor</h1>
    <span class="status ready" id="status">Ready</span>

    <div class="upload-zone" id="upload-zone">
        <p>Drop PDF or text file here or click to upload</p>
        <input type="file" id="file-input" style="display: none" accept=".pdf,.txt">
    </div>

    <div class="results" id="results">
        <h2>Analysis Results</h2>
        
        <div class="grid">
            <div class="card">
                <h3>Document Statistics</h3>
                <div id="stats"></div>
            </div>

            <div class="card">
                <h3>Participants</h3>
                <div id="participants"></div>
            </div>

            <div class="card">
                <h3>Topics</h3>
                <div id="topics"></div>
            </div>

            <div class="card">
                <h3>Metadata</h3>
                <div id="metadata"></div>
            </div>
        </div>

        <div class="card">
            <h3>Content Preview</h3>
            <div id="preview" class="preview"></div>
        </div>
    </div>

    <div class="log" id="log">
        > System ready
    </div>

    <script>
        const uploadZone = document.getElementById('upload-zone');
        const fileInput = document.getElementById('file-input');
        const status = document.getElementById('status');
        const results = document.getElementById('results');
        const stats = document.getElementById('stats');
        const participants = document.getElementById('participants');
        const topics = document.getElementById('topics');
        const metadata = document.getElementById('metadata');
        const preview = document.getElementById('preview');
        const log = document.getElementById('log');

        // File Upload Events
        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = '#2196F3';
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.style.borderColor = '';
        });
        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            const files = e.dataTransfer.files;
            if (files.length > 0) processFile(files[0]);
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) processFile(e.target.files[0]);
        });

        async function processFile(file) {
            if (!file.type.includes('pdf') && !file.type.includes('text/plain')) {
                alert('Please upload a PDF or text file');
                return;
            }

            try {
                updateStatus('processing');
                updateLog('Processing file: ' + file.name);

                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch('/process', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`Processing failed: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.status === 'success') {
                    updateStatus('ready');
                    showResults(result);
                    updateLog('Processing complete');
                } else {
                    throw new Error(result.message || 'Processing failed');
                }
            } catch (error) {
                console.error('Error:', error);
                updateStatus('error');
                updateLog(`Error: ${error.message}`);
            }
        }

        function updateStatus(state) {
            status.className = `status ${state}`;
            status.textContent = state.charAt(0).toUpperCase() + state.slice(1);
        }

        function updateLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML = `> ${timestamp} ${message}\n${log.innerHTML}`;
        }

        function showResults(result) {
            results.style.display = 'block';

            // Show statistics
            stats.innerHTML = `
                <p><strong>Pages:</strong> ${result.pages}</p>
                <p><strong>Words:</strong> ${result.words}</p>
                <p><strong>Processing Time:</strong> ${result.processingTime}</p>
            `;

            // Show participants
            participants.innerHTML = Array.from(result.content.participants)
                .map(p => `<span class="tag">${p}</span>`)
                .join('');

            // Show topics
            topics.innerHTML = Array.from(result.content.topics)
                .map(t => `<span class="tag">${t}</span>`)
                .join('');

            // Show metadata
            metadata.innerHTML = `<pre>${JSON.stringify(result.content.metadata, null, 2)}</pre>`;

            // Show preview
            preview.textContent = result.content.text;
        }
    </script>
</body>
</html>
